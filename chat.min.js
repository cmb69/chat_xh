function Chat(a,b,c){var d=this;this.room=a,this.url=b+"&chat_room="+this.room+"&chat_ajax=",this.container=document.getElementById("chat_room_"+a),this.messages=document.getElementById("chat_room_"+a+"_messages"),this.form=document.getElementById("chat_room_"+a+"_form"),this.scrollDown(),typeof window.XMLHttpRequest!="undefined"&&(this.form.onsubmit=function(){return d.submit()},setInterval(function(){d.poll()},c))}Chat.prototype.clearInput=function(){this.form.elements.chat_message.value=""},Chat.prototype.scrollDown=function(){this.messages.scrollTop=this.messages.scrollHeight},Chat.prototype.poll=function(){var a=this,b=this.messages.scrollTop>=this.messages.scrollHeight-this.messages.clientHeight,c=new XMLHttpRequest;c.open("GET",this.url+"read"),c.onreadystatechange=function(){c.readyState==4&&c.status==200&&(a.messages.innerHTML=c.responseText,b&&a.scrollDown())},c.send(null)},Chat.prototype.submit=function(){var a=this,b=new XMLHttpRequest;b.open("POST",this.url+"write"),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){b.readyState==4&&b.status==200&&(a.messages.innerHTML=b.responseText,a.scrollDown(),a.clearInput())};var c=this.form.elements.chat_message.value;return b.send("chat_message="+window.encodeURIComponent(c)),!1}